# SLO_ALERTING

## 目的
「何が壊れているか」を最短で判断できるように、SLO とアラートの最小標準を定義する。

## 用語
- **SLI**: 指標（例: 成功率、レイテンシ）
- **SLO**: 目標（例: 30日成功率 99.9%）
- **Error Budget**: 許容できる失敗の枠（SLO 未達の余地）

## 最小SLO（テンプレ）
以下は例。実際の値はプロダクト要件（UX/収益/法令）で決める。

### 外部API（Gateway）
- 成功率（HTTP 5xx を失敗）
- レイテンシ（p95/p99）

### 内部API（gRPC）
- 成功率（gRPC status を失敗判定）
- レイテンシ（p95/p99）

### 同期系（CDC/Indexer）
- DB更新→検索反映の遅延（p95）
- DLQ の件数・滞留時間

## アラート設計（推奨）
- **症状アラート**: ユーザー影響（成功率低下、遅延増大）
- **原因候補アラート**: 依存先（DB/ES/Kafka）の失敗率、接続枯渇、キュー滞留

### Burn-rate の考え方（概要）
- Error Budget の消費速度が速いときに通知する
- 速い窓（例: 5〜30分）と遅い窓（例: 6〜24時間）を組み合わせる

## 最小Runbook（オンコール手順）
- 1) 影響範囲を確認（Gateway か特定サービスか）
- 2) 直近デプロイ/マイグレーション有無を確認
- 3) リクエスト相関（`request_id` / `trace_id`）でボトルネックを特定
- 4) 依存先（DB/ES/Kafka）の失敗率・レイテンシを確認
- 5) 一時緩和（レート制限強化、重い機能の切り離し、ロールバック）

## ダッシュボード最低要件
- サービス別: RPS、エラー率、p95/p99、サチュレーション（CPU/メモリ/コネクション）
- 依存先別: DB/ES/Kafka のレイテンシと失敗率
- 同期: E2E遅延、DLQ

## 関連
- 05_operations/OBSERVABILITY.md
- 01_architecture/SYNC_STRATEGY.md
